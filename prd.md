# [PRD] 경조사 및 선물 관리 앱: 주고받고

## 1. 프로젝트 개요

* **서비스 명:** 주고받고 (Ju-Go-Bat-Go)
* **목적:** 개인 간 주고받은 현금, 선물, 금 등의 내역을 체계적으로 관리하고, 관계의 온도를 시각화하여 건강한 인간관계를 유지하도록 돕는 자산 및 인맥 관리 서비스.
* **플랫폼:** 모바일 앱 (iOS/Android)
* **AI모델:** Google Gemini 1.5 Flash (멀티모달 가격 추정 및 관계 분석)
---

## 2. 상세 기능 요구사항

### 2.1. 계정 및 인증 (Auth)

* **소셜 로그인:** Naver, Kakao, Google API 연동을 통한 간편 로그인 지원.
* **최초 진입 시:** 개인정보 처리 방침 및 동의 (필수):
서비스 이용약관: 필수 동의.
개인정보 수집 및 이용 동의: 계정 정보, 거래 내역 저장.
민감정보 수집 동의: 금융 성격의 데이터(금액, 거래 유형) 취급에 따른 동의.
연락처 접근 권한: 휴대폰 주소록 동기화 및 관리를 위한 권한 승인.
마케팅 수집/푸시 알림: 선택 동의 (경조사 리마인드용).

### 2.2. 홈 화면 (Home)

* **빈 화면(Empty State):** 등록된 데이터가 없을 시 "연락처를 등록하여 주고받은 내역을 관리해 보세요!" 문구와 함께 [연락처 불러오기] 버튼 노출.
* **상단 요약:** [총 받은 금액], [총 준 금액], [잔액(순수익/지출)]을 카드 형태로 시각화.
* **사람별 통계 섹션:** * 표 형태로 제공 (장부명, 이름, 받은 금액, 준 금액, 잔액).
* **주받 온도계:** 특정 인물 클릭 시 하단 슬라이드 팝업으로 등장.
* **최근 거래 섹션:** 장부 전체의 최신 거래 내역 리스트 (이름, 날짜, 선물명, 금액).
* **통계 요약 섹션:** 세부 카테고리별 요약 (전체/장부별 거래건수, 주받 지수, 금액 합계).

### 2.3. 연락처 관리 (Contacts)

* **연락처 동기화:** 휴대폰 내 주소록 접근 권한 승인 후 리스트 호출.
* **장부 지정:** 불러온 연락처 중 관리 대상자를 선택하고 그룹(장부: 가족, 친구, 회사 등)에 할당.
* **기준 정보 설정:** 여기서 설정된 인물이 '장부' 및 '통계' 탭의 기준 데이터가 됨.

### 2.4. 장부 관리 (Ledger)

* **그룹 탭 생성:** 연락처 탭에서 설정된 장부 그룹(예: 회사, 친구)이 상단 탭으로 자동 생성.
* **거래 리스트:** * 표기 항목: 이름, 날짜, 상품명(내용), 금액.
* **줌/받음 구분:** 금액 옆에 아이콘 또는 배경색(예: 줌-파란색, 받음-빨간색)으로 강조.


* **새 거래 추가 (Floating Button):** * **이름:** 단수/복수 선택 가능 (단축 검색 기능 포함).
* **유형:** 받은 것 / 준 것 선택.
* **분류:** 현금, 선물, 금 중 선택.
* **날짜/금액/메모:** 수기 입력.


* **특수 기능 (AI & 외부 연동):**
* **선물 선택 시:** 선물 이미지 업로드 또는 상품명 입력 시 **AI 가격 추정** (네이버 쇼핑/다나와 등 API 연동 혹은 LLM 기반 추정).
* **금 선택 시:** 동적 입력창 활성화.
* 입력항목: 순도(24K/18K/14K), 무게, 단위(g, 돈, oz).
* **시세 연동:** KRX 금 시세 API를 호출하여 **전일 종가 기준** 자동 환산 금액 표기.





### 2.5. 통계 (Statistics)

* **필터:** 상단에 연도별/월별/기간 지정 필터 배치.
* **종합 통계:** 해당 기간 내 총 받은 금액, 준 금액, 순 잔액.
* **추이 그래프:** 월별/연도별 수지 변화를 꺾은선 또는 막대 그래프로 제공.
* **카테고리/장부별 비중:** 원형 차트(Donut Chart)로 시각화.
* **인물별 통계:** * 상위 5명 우선 노출 및 더보기 기능.
* 인물 우측에 [선물하기] 버튼 배치하여 탭 이동 유도.



### 2.6. 의견 남기기 (Feedback)

* **카테고리 선택:** [버그 제보 / 기능 제안 / 사용 문의 / 기타] 중 선택.
* **내용 입력:** 텍스트 및 스크린샷 첨부 기능.

---

## 3. 추가 제안 사항

### 3.1. "선물하기" 탭 추천 구성

> 사용자가 받은 만큼 돌려주거나, 고마운 마음을 전할 때 고민을 덜어주는 '큐레이션' 중심의 화면을 제안합니다.

* **AI 맞춤 추천:** 주받 온도계 데이터를 기반으로 '상대에게 받은 금액대와 비슷한 선물' 추천.
* **상황별 카테고리:** 결혼식, 돌잔치, 생일, 가벼운 응원 등 상황별 베스트 아이템 나열.
* **외부 플랫폼 연동:** '카카오톡 선물하기' 또는 '쿠팡' 딥링크를 연결하여 실제 구매로 이어지게 함.
* **위시리스트:** 나중에 주고 싶은 선물을 미리 저장해두는 기능.

### 3.2. 개인 설정 (Settings) 추천

* **기본 통화/단위 설정:** 금 무게 단위(돈/g) 기본값, 기본 화폐 단위 설정.
* **알림 설정:** 지인 생일(연락처 기반), 경조사 리마인드 푸시 알림.
* **데이터 백업/내보내기:** 전체 장부 내역을 **Excel 또는 PDF**로 추출하는 기능 (세무 증빙이나 개인 보관용).
* **잠금 설정:** 금융 데이터이므로 생체 인증(FaceID/지문) 또는 비밀번호 잠금 기능.

### 3.3. 관리자 화면 (Admin Panel) 추천

* **대시보드:** 총 가입자 수(누적/신규), 일일 활성 사용자(DAU), 총 거래 등록 수.
* **인기 선물 순위:** 사용자들이 가장 많이 등록하는 선물 키워드 모니터링.
* **금 시세 관리:** API 연동 상태 점검 및 수동 업데이트 기능.
* **CS 관리:** 사용자가 보낸 '의견 남기기' 리스트 확인 및 답변 상태 관리.

---

## 4. 기술 스택 및 비기능 요구사항 (참고)

* **AI 모델:** OpenAI GPT-4o 또는 Google Gemini Pro Vision (이미지 분석 및 가격 추정용).
* **데이터베이스:** 사용자별 장부 데이터를 안전하게 보호하기 위한 암호화 저장.
* **보안:** 개인정보 처리방침 준수 및 소셜 로그인 보안 토큰 관리.



## 5. [신규] 주받 온도계 계산식 및 멘트 로직

사용자와 특정 대상 간의 상호작용 균형을 **0도에서 100도** 사이로 수치화합니다.

### 5.1. 계산 공식

$$온도(T) = 50 + \left( \frac{\text{준 금액}(A) - \text{받은 금액}(B)}{\text{준 금액}(A) + \text{받은 금액}(B)} \times 50 \right)$$(단, $A+B=0$인 경우 온도는 기본값 50도로 설정)

### 5.2. 구간별 상태 및 멘트 예시 (Gemini 생성 기준)

| 온도 (T) | 상태 | 멘트 예시 (Gemini 1.5 Flash 생성용 가이드) |
| --- | --- | --- |
| **80 ~ 100도** | **열정적 배려** | "당신의 따뜻한 마음이 상대방에게 깊이 전달되고 있습니다. 베푸신 만큼 큰 감사로 돌아올 거예요." |
| **60 ~ 79도** | **훈훈한 관계** | "배려의 온기가 가득합니다. 상대방도 당신의 세심한 마음을 충분히 느끼고 있을 것입니다." |
| **40 ~ 59도** | **완벽한 균형** | "서로 마음을 주고받는 이상적인 균형 상태입니다. 신뢰가 두터운 관계군요." |
| **20 ~ 39도** | **감사의 필요** | "상대방으로부터 많은 고마움을 받았습니다. 작은 안부나 선물로 마음을 표현해 보시는 건 어떨까요?" |
| **0 ~ 19도** | **분발 필요** | "받은 마음이 꽤 쌓여 있습니다. 잊고 있었던 고마움을 전하기에 가장 좋은 타이밍입니다." |

[주고받고 (Ju-Go-Bat-Go)] 서비스의 사용자 경험을 구체화하기 위해, **사용자 여정(User Journey)에 따른 메인 시나리오**를 PRD에 추가합니다. 이 시나리오는 앞서 설계한 **DB 구조**와 **TRD의 기술 요소**가 어떻게 상호작용하는지를 보여줍니다.

---

# 6. 서비스 이용 시나리오 및 기술 통합

## 1. 메인 시나리오: "결혼식 답례와 관계 관리"
**사용자 페르소나:** 30대 직장인 김철수 (최근 본인의 결혼식을 마침)

### 시나리오 01: 온보딩 및 인맥 동기화
*   **사용자 행동:** 앱 설치 후 카카오 로그인을 하고, 연락처 동기화 버튼을 누른다.
*   **시스템 동작:** 
    *   (Auth) Supabase Auth를 통해 유저 세션 생성 및 `profiles` 테이블에 기본 정보 저장.
    *   (Contacts) 휴대폰 주소록 데이터를 가져와 `contacts` 테이블에 대량 삽입(Batch Insert).
    *   (Groups) 사용자가 '직장 동료', '대학 친구' 그룹을 생성하면 `groups` 테이블에 저장.
*   **DB 연결:** `profiles` (유저 생성) → `groups` (카테고리 생성) → `contacts` (인물 매칭).

### 시나리오 02: 받은 축의금(현금) 대량 등록
*   **사용자 행동:** 결혼식 방명록을 보고 '대학 친구' 그룹의 '이영희'에게 받은 축의금 10만 원을 입력한다.
*   **시스템 동작:**
    *   (Ledger) `transactions` 테이블에 데이터 생성. 
    *   **입력값:** `type: RECEIVE`, `category: CASH`, `amount: 100000`, `contact_id: 영희ID`.
*   **DB 연결:** `transactions` 테이블의 `amount` 필드에 100,000 저장.

### 시나리오 03: 선물(물품) 주고받기 및 AI 가격 추정
*   **사용자 행동:** 고마운 친구 '박지민'에게 답례로 '정관장 홍삼 세트'를 보낸 후, 상품 사진을 찍어 올린다.
*   **시스템 동작:**
    *   (AI/Gemini) 사용자가 업로드한 이미지를 **Gemini 1.5 Flash**가 분석하여 "정관장 활기력 세트"임을 식별하고, 현재 시장가인 "54,000원"을 추정값으로 제안.
    *   (Storage) 이미지는 **Supabase Storage**에 저장되고, 해당 URL은 `transactions.image_url`에 기록.
    *   (Ledger) 최종 승인 시 `type: GIVE`, `category: GIFT`, `amount: 54000`으로 저장.
*   **DB 연결:** `transactions` 테이블에 AI가 계산한 금액과 이미지 경로 저장.

### 시나리오 04: 주받 온도 확인 및 관계 분석
*   **사용자 행동:** '박지민'의 상세 프로필을 클릭하여 우리 사이의 '주받 온도'를 확인한다.
*   **시스템 동작:**
    *   (Statistics) DB의 `contact_statistics` 뷰(View)를 조회. 
    *   **계산 로직:** 
        *   준 금액(GIVE): 54,000원 (선물)
        *   받은 금액(RECEIVE): 50,000원 (과거에 받은 축의금)
        *   온도 계산: $50 + ((54,000 - 50,000) / (54,000 + 50,000) \times 50) \approx 51.92$도.
    *   **결과:** "완벽한 균형 - 서로 마음을 주고받는 이상적인 상태입니다." 멘트 노출.
*   **DB 연결:** `contact_statistics` 뷰를 통한 실시간 수치 연산.

### 시나리오 05: 금(Gold) 선물 등록 (특수 케이스)
*   **사용자 행동:** 조카 돌잔치에 '금반지 1돈(3.75g)'을 선물하고 기록한다.
*   **시스템 동작:**
    *   (Gold API) 백엔드에서 `gold_rates` 테이블의 최신 시세(예: 1g당 100,000원)를 호출.
    *   (Calculation) `3.75g * 100,000원 = 375,000원` 자동 계산.
    *   (Ledger) `category: GOLD`, `gold_details: {"purity": "24K", "weight": 3.75}`, `amount: 375000` 저장.
*   **DB 연결:** `gold_rates` 시세 참조 및 `transactions`의 `gold_details` JSONB 필드 활용.

---

## 2. 기술 통합 매트릭스 (TRD 요약 버전)

| 단계 | 기능 | 관련 기술 (Tech) | 관련 DB 테이블/뷰 |
| :--- | :--- | :--- | :--- |
| **인증** | 소셜 로그인 | Supabase Auth / OAuth | `profiles` |
| **인맥** | 연락처 동기화 | React Native Contacts / Batch API | `contacts`, `groups` |
| **등록** | AI 가격 추정 | **Google Gemini 1.5 Flash** | `transactions` (`amount`) |
| **저장** | 영수증/선물 이미지 | **Supabase Storage** | `transactions` (`image_url`) |
| **시세** | 금 시세 환산 | Public Gold API / Node Cron | `gold_rates` |
| **분석** | 주받 온도계 | PostgreSQL View / Math Logic | `contact_statistics` (View) |
| **통계** | 지출/수입 리포트 | TanStack Query / Victory Native | `transactions` (Aggregation) |

---

## 3. 예외 시나리오 (Edge Cases)
1.  **AI 가격 추정 실패:** Gemini가 이미지를 인식하지 못할 경우, 사용자가 직접 금액을 입력할 수 있도록 수동 입력창을 즉시 활성화함.
2.  **연락처 중복:** 동일한 전화번호로 등록된 연락처가 있을 경우, 기존 `contacts` 데이터를 업데이트(Upsert)하거나 그룹만 추가 지정하도록 유도.
3.  **오프라인 환경:** 네트워크 단절 시 입력을 로컬 스토리지에 임시 저장하고, 온라인 상태 복귀 시 Supabase와 동기화.
